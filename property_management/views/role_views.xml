<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tenant View for Properties (Read-only) -->
    <record id="view_property_form_tenant" model="ir.ui.view">
        <field name="name">property.property.form.tenant</field>
        <field name="model">property.property</field>
        <field name="inherit_id" ref="property_management.view_property_form"/>
        <field name="arch" type="xml">

            <!-- Restrict form to tenant group -->
            <xpath expr="//form" position="attributes">
                <attribute name="groups">property_management.group_tenant_user</attribute>
            </xpath>

            <!-- Make all fields read-only -->
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='description']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='address']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='property_kind']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='monthly_rate']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='expected_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='selling_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='size']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>

            <!-- Remove ALL header buttons for tenants -->
            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" widget="statusbar"
                           statusbar_colors='{"draft": "grey", "available": "blue", "sold": "green", "cancelled": "red"}'/>
                </header>
            </xpath>

            <!-- Remove button box actions -->
            <xpath expr="//div[@class='oe_button_box']" position="replace"/>

            <!-- Remove chatter for tenants -->
            <xpath expr="//div[@class='oe_chatter']" position="replace"/>
        </field>
    </record>

    <!-- Sales Agent View (Limited Editing) -->
    <record id="view_property_form_agent" model="ir.ui.view">
        <field name="name">property.property.form.agent</field>
        <field name="model">property.property</field>
        <field name="inherit_id" ref="property_management.view_property_form"/>
        <field name="arch" type="xml">
            <!-- Restrict form to sales agent group -->
            <xpath expr="//form" position="attributes">
                <attribute name="groups">property_management.group_sales_agent</attribute>
            </xpath>
            <!-- Restrict certain fields -->
            <xpath expr="//field[@name='expected_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='selling_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <!-- Replace header to limit actions for agents -->
            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" widget="statusbar"
                           statusbar_colors='{"draft": "grey", "available": "blue", "sold": "green", "cancelled": "red"}'/>
                    <button name="action_mark_available" type="object"
                            string="Mark Available" class="btn-primary"
                            invisible="state != 'draft'"
                    />
                    <button name="action_mark_sold" type="object"
                            string="Mark as Sold" class="btn-primary"
                            invisible="state not in ('draft','available')"
                    />
                    <button name="action_mark_cancelled" type="object"
                            string="Cancel Listing" class="btn-secondary"
                            invisible="state not in ('draft','available')"
                    />
                    <button name="action_reopen" type="object"
                            string="Reopen" class="btn-secondary"
                            invisible="state not in ('sold','cancelled')"
                    />
                </header>
            </xpath>
        </field>
    </record>
</odoo>
