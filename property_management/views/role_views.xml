<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tenant View for Properties (Read-only) -->
    <record id="view_property_form_tenant" model="ir.ui.view">
        <field name="name">property.property.form.tenant</field>
        <field name="model">property.property</field>
        <field name="inherit_id" ref="property_management.view_property_form"/>
        <field name="groups" eval="[(4, ref('property_management.group_tenant_user'))]"/>
        <field name="arch" type="xml">
            <!-- Make all fields read-only for tenants -->
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='description']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='address']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='property_kind']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='monthly_rate']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='expected_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='selling_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='size']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>

            <!-- Remove ALL header buttons for tenants (safer approach) -->
            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" widget="statusbar" statusbar_colors='{"draft": "grey", "available": "blue", "sold": "green", "cancelled": "red"}'/>
                </header>
            </xpath>

            <!-- Remove the Mark as Sold button from button box -->
            <xpath expr="//div[@class='oe_button_box']/button[@name='action_mark_as_sold']" position="replace"/>

            <!-- Remove chatter for tenants -->
            <xpath expr="//div[@class='oe_chatter']" position="replace"/>
        </field>
    </record>

    <!-- Sales Agent View (Limited Editing) -->
    <record id="view_property_form_agent" model="ir.ui.view">
        <field name="name">property.property.form.agent</field>
        <field name="model">property.property</field>
        <field name="inherit_id" ref="property_management.view_property_form"/>
        <field name="groups" eval="[(4, ref('property_management.group_sales_agent'))]"/>
        <field name="arch" type="xml">
            <!-- Make certain fields read-only for agents -->
            <xpath expr="//field[@name='expected_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='selling_price']" position="attributes">
                <attribute name="readonly">1</attribute>
            </xpath>

            <!-- Remove delete action for agents by replacing the header -->
            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" widget="statusbar" statusbar_colors='{"draft": "grey", "available": "blue", "sold": "green", "cancelled": "red"}"/>
                    <button name="action_mark_available" type="object"
                            string="Mark Available" class="btn-primary"
                            invisible="state != 'draft'"
                            title="Make this property available for rent/sale"
                    />
                    <button name="action_mark_sold" type="object"
                            string="Mark as Sold" class="btn-primary"
                            invisible="not (state == 'draft' or state == 'available')"
                            title="Mark this property as sold"
                    />
                    <button name="action_mark_cancelled" type="object"
                            string="Cancel Listing" class="btn-secondary"
                            invisible="not (state == 'draft' or state == 'available')"
                            title="Cancel this property listing"
                    />
                    <button name="action_reopen" type="object"
                            string="Reopen" class="btn-secondary"
                            invisible="not (state == 'sold' or state == 'cancelled')"
                            title="Reopen this property for editing"
                    />
                </header>
            </xpath>
        </field>
    </record>
</odoo>