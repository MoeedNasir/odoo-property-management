<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Security Groups -->
    <record id="group_property_manager" model="res.groups">
        <field name="name">Property Manager</field>
        <field name="category_id" ref="base.module_category_sales"/>
        <field name="users" eval="[(4, ref('base.user_admin'))]"/>
    </record>

    <record id="group_sales_agent" model="res.groups">
        <field name="name">Sales Agent</field>
        <field name="category_id" ref="base.module_category_sales"/>
    </record>

    <record id="group_tenant_user" model="res.groups">
        <field name="name">Tenant User</field>
        <field name="category_id" ref="base.module_category_sales"/>
    </record>

    <!-- Implied Rules -->
    <record id="group_property_manager_implied" model="res.groups">
        <field name="name">Property Manager (Full Access)</field>
        <field name="category_id" ref="base.module_category_sales"/>
        <field name="implied_ids" eval="[(4, ref('property_management.group_sales_agent'))]"/>
        <field name="users" eval="[(4, ref('base.user_admin'))]"/>
    </record>

    <!-- Access Rules for Property Model -->
    <record id="property_property_manager_rule" model="ir.rule">
        <field name="name">Property Manager: Full Access</field>
        <field name="model_id" ref="model_property_property"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_property_manager'))]"/>
    </record>

    <record id="property_property_sales_agent_rule" model="ir.rule">
        <field name="name">Sales Agent: Own and Available Properties</field>
        <field name="model_id" ref="model_property_property"/>
        <field name="domain_force">['|', ('state', '=', 'available'), ('create_uid', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_sales_agent'))]"/>
    </record>

    <record id="property_property_tenant_rule" model="ir.rule">
        <field name="name">Tenant: Only Assigned Properties</field>
        <field name="model_id" ref="model_property_property"/>
        <field name="domain_force">[('tenant_ids.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_tenant_user'))]"/>
    </record>

    <!-- Access Rules for Tenant Model -->
    <record id="property_tenant_manager_rule" model="ir.rule">
        <field name="name">Tenant Manager: Full Access</field>
        <field name="model_id" ref="model_property_tenant"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_property_manager'))]"/>
    </record>

    <record id="property_tenant_sales_agent_rule" model="ir.rule">
        <field name="name">Sales Agent: Related Tenants</field>
        <field name="model_id" ref="model_property_tenant"/>
        <field name="domain_force">[('property_id.create_uid', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_sales_agent'))]"/>
    </record>

    <record id="property_tenant_self_rule" model="ir.rule">
        <field name="name">Tenant: Own Record Only</field>
        <field name="model_id" ref="model_property_tenant"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_tenant_user'))]"/>
    </record>

    <!-- Access Rules for Payment Model -->
    <record id="property_payment_manager_rule" model="ir.rule">
        <field name="name">Payment Manager: Full Access</field>
        <field name="model_id" ref="model_property_payment"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_property_manager'))]"/>
    </record>

    <record id="property_payment_sales_agent_rule" model="ir.rule">
        <field name="name">Sales Agent: Related Payments</field>
        <field name="model_id" ref="model_property_payment"/>
        <field name="domain_force">[('property_id.create_uid', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_sales_agent'))]"/>
    </record>

    <record id="property_payment_tenant_rule" model="ir.rule">
        <field name="name">Tenant: Own Payments Only</field>
        <field name="model_id" ref="model_property_payment"/>
        <field name="domain_force">[('tenant_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('property_management.group_tenant_user'))]"/>
    </record>
</odoo>